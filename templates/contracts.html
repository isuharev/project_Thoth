<!-- templates/home.html -->
{% extends 'base.html' %}
{% load static %}


{% block content %}
<link href="{% static 'css/home.css' %}" rel="stylesheet">

<style>
#myInput {
  background-image: url('/static/searchicon.png');
  background-position: 10px 10px;
  background-repeat: no-repeat;
  width: 60%;
  font-size: 16px;
  padding: 12px 20px 12px 40px;
  border: 1px solid #ddd;
  margin-bottom: 12px;
  box-shadow: 0.4em 0.4em 5px rgba(122,122,122,0.5);
}

* {
  box-sizing: border-box;
}

.table_sort table {
    border-collapse: collapse;
}

.table_sort th {
    color: #ffebcd;
    background: #008b8b;
    cursor: pointer;
}
.table_sort th:first-child, .table_sort td:first-child {
width: 22%;
text-align: left;
}
.table_sort td,
.table_sort th {
    width: 150px;
    height: 40px;
    text-align: center;
    border: 1px solid #846868;
}

.table_sort tbody tr:nth-child(even) {
    background: #e3e3e3;
}

th.sorted[data-order="1"],
th.sorted[data-order="-1"] {
    position: relative;
}

th.sorted[data-order="1"]::after,
th.sorted[data-order="-1"]::after {
    right: 8px;
    position: absolute;
}

th.sorted[data-order="-1"]::after {
	content: "▼"
}

th.sorted[data-order="1"]::after {
	content: "▲"
}
</style>

<input type="text" id="myInput" onkeyup="tableSearch()" placeholder="Поиск по таблице...">
<script>
    function tableSearch() {
    var phrase = document.getElementById('myInput');
    var table = document.getElementById('info-table');
    var regPhrase = new RegExp(phrase.value, 'i');
    var flag = false;
    for (var i = 1; i < table.rows.length; i++) {
        flag = false;
        for (var j = table.rows[i].cells.length - 1; j >= 0; j--) {
            flag = regPhrase.test(table.rows[i].cells[j].innerHTML);
            if (flag) break;
        }
        if (flag) {
            table.rows[i].style.display = "";
        } else {
            table.rows[i].style.display = "none";
        }

    }
}
</script>

<script>
    document.addEventListener('DOMContentLoaded', () => {

    const getSort = ({ target }) => {
        const order = (target.dataset.order = -(target.dataset.order || -1));
        const index = [...target.parentNode.cells].indexOf(target);
        const collator = new Intl.Collator(['en', 'ru'], { numeric: true });
        const comparator = (index, order) => (a, b) => order * collator.compare(
            a.children[index].innerHTML,
            b.children[index].innerHTML
        );

        for(const tBody of target.closest('table').tBodies)
            tBody.append(...[...tBody.rows].sort(comparator(index, order)));

        for(const cell of target.parentNode.cells)
            cell.classList.toggle('sorted', cell === target);
    };

document.querySelectorAll('.table_sort thead').forEach(tableTH => tableTH.addEventListener('click', () => getSort(event)));

});
</script>


<table class="table_sort" id="info-table">
    <thead>
        <tr>
        <th>Договор</th>
        <th>№ договора</th>
        <th>Дата заключения</th>
        <th>Контрагент</th>
        <th>Стоимость</th>
        <th>Статус</th>
        <th>Автор регистрации</th>
        </tr>
    </thead>
    <tbody>
    {% for item in object_list %}
        <tr>
            <td><a href="{% url 'detail' item.pk %}" class="link_in_table">{{ item.contract_full_name }}</a></td>
            <td>{{ item.number }}</td>
            <td>{{ item.contract_date|default:"Не указана"  }}</td>
            <td>{{ item.contract_agent }}</td>
            <td>{{ item.contract_cost }}</td>
            <td>{{ item.contract_status }}</td>
            <td>{{ item.author }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endblock content %}